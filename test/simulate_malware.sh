#!/bin/bash
# test/simulate_malware.sh
# Simulates common malware behaviors to test event capture
# Run this WHILE azazel is running, then check the output

set -x  # Show every command for debugging

echo "=== [1] Process execution ==="
/bin/echo "hello from child process"
/usr/bin/whoami
/bin/ls /tmp

echo "=== [2] File operations ==="
echo "malware payload" > /tmp/evil_payload.bin
cat /tmp/evil_payload.bin
cp /tmp/evil_payload.bin /tmp/evil_copy.bin
mv /tmp/evil_copy.bin /tmp/evil_renamed.bin
rm -f /tmp/evil_payload.bin /tmp/evil_renamed.bin

echo "=== [3] Sensitive file access ==="
cat /etc/passwd > /dev/null 2>&1
cat /etc/shadow > /dev/null 2>&1
ls /etc/ssh/ > /dev/null 2>&1

echo "=== [4] Network activity ==="
# DNS query
dig google.com +short > /dev/null 2>&1 || nslookup google.com > /dev/null 2>&1 || true
# TCP connection attempt
nc -z -w1 1.1.1.1 80 2>/dev/null || true
nc -z -w1 1.1.1.1 443 2>/dev/null || true

echo "=== [5] Execution from /tmp (suspicious) ==="
cp /bin/echo /tmp/suspicious_binary
chmod +x /tmp/suspicious_binary
/tmp/suspicious_binary "I am executing from /tmp"
rm -f /tmp/suspicious_binary

echo "=== [6] Process relationships ==="
bash -c 'echo "child of child"'
(echo "subshell process")

echo "=== Done ==="
